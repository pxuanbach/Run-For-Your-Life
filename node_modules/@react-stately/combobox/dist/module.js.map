{"mappings":"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","sources":["./packages/@react-stately/combobox/src/useComboBoxState.ts"],"sourcesContent":["/*\n * Copyright 2020 Adobe. All rights reserved.\n * This file is licensed to you under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License. You may obtain a copy\n * of the License at http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software distributed under\n * the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\n * OF ANY KIND, either express or implied. See the License for the specific language\n * governing permissions and limitations under the License.\n */\n\nimport {Collection, FocusStrategy, Node} from '@react-types/shared';\nimport {ComboBoxProps, MenuTriggerAction} from '@react-types/combobox';\nimport {ListCollection, useSingleSelectListState} from '@react-stately/list';\nimport {SelectState} from '@react-stately/select';\nimport {useControlledState} from '@react-stately/utils';\nimport {useEffect, useMemo, useRef, useState} from 'react';\nimport {useMenuTriggerState} from '@react-stately/menu';\n\nexport interface ComboBoxState<T> extends SelectState<T> {\n  /** The current value of the combo box input. */\n  inputValue: string,\n  /** Sets the value of the combo box input. */\n  setInputValue(value: string): void,\n  /** Selects the currently focused item and updates the input value. */\n  commit(): void,\n  /** Opens the menu. */\n  open(focusStrategy?: FocusStrategy | null, trigger?: MenuTriggerAction): void,\n  /** Toggles the menu. */\n  toggle(focusStrategy?: FocusStrategy | null, trigger?: MenuTriggerAction): void\n}\n\ntype FilterFn = (textValue: string, inputValue: string) => boolean;\ninterface ComboBoxStateProps<T> extends ComboBoxProps<T> {\n  /** The filter function used to determine if a option should be included in the combo box list. */\n  defaultFilter?: FilterFn,\n  /** Whether the combo box allows the menu to be open when the collection is empty. */\n  allowsEmptyCollection?: boolean,\n  /** Whether the combo box menu should close on blur. */\n  shouldCloseOnBlur?: boolean\n}\n\n/**\n * Provides state management for a combo box component. Handles building a collection\n * of items from props and manages the option selection state of the combo box. In addition, it tracks the input value,\n * focus state, and other properties of the combo box.\n */\nexport function useComboBoxState<T extends object>(props: ComboBoxStateProps<T>): ComboBoxState<T> {\n  let {\n    defaultFilter,\n    menuTrigger = 'input',\n    allowsEmptyCollection = false,\n    allowsCustomValue,\n    shouldCloseOnBlur = true\n  } = props;\n\n  let [showAllItems, setShowAllItems] = useState(false);\n  let [isFocused, setFocusedState] = useState(false);\n  let [inputValue, setInputValue] = useControlledState(\n    props.inputValue,\n    props.defaultInputValue ?? '',\n    props.onInputChange\n  );\n\n  let onSelectionChange = (key) => {\n    if (props.onSelectionChange) {\n      props.onSelectionChange(key);\n    }\n\n    // If open state or selectedKey is uncontrolled and key is the same, reset the inputValue and close the menu\n    // (scenario: user clicks on already selected option)\n    if (props.isOpen === undefined || props.selectedKey === undefined) {\n      if (key === selectedKey) {\n        resetInputValue();\n        triggerState.close();\n      }\n    }\n  };\n\n  let {collection, selectionManager, selectedKey, setSelectedKey, selectedItem, disabledKeys} = useSingleSelectListState({\n    ...props,\n    onSelectionChange,\n    items: props.items ?? props.defaultItems\n  });\n\n  // Preserve original collection so we can show all items on demand\n  let originalCollection = collection;\n  let filteredCollection = useMemo(() => (\n    // No default filter if items are controlled.\n    props.items != null || !defaultFilter\n      ? collection\n      : filterCollection(collection, inputValue, defaultFilter)\n  ), [collection, inputValue, defaultFilter, props.items]);\n\n  // Track what action is attempting to open the menu\n  let menuOpenTrigger = useRef('focus' as MenuTriggerAction);\n  let onOpenChange = (open: boolean) => {\n    if (props.onOpenChange) {\n      props.onOpenChange(open, open ? menuOpenTrigger.current : undefined);\n    }\n  };\n\n  let triggerState = useMenuTriggerState({...props, onOpenChange});\n  let open = (focusStrategy?: FocusStrategy, trigger?: MenuTriggerAction) => {\n    let displayAllItems = (trigger === 'manual' || (trigger === 'focus' && menuTrigger === 'focus'));\n    // Prevent open operations from triggering if there is nothing to display\n    // Also prevent open operations from triggering if items are uncontrolled but defaultItems is empty, even if displayAllItems is true.\n    // This is to prevent comboboxes with empty defaultItems from opening but allow controlled items comboboxes to open even if the inital list is empty (assumption is user will provide swap the empty list with a base list via onOpenChange returning `menuTrigger` manual)\n    if (allowsEmptyCollection || filteredCollection.size > 0 || (displayAllItems && originalCollection.size > 0) || props.items) {\n      if (displayAllItems && !triggerState.isOpen && props.items === undefined) {\n        // Show all items if menu is manually opened. Only care about this if items are undefined\n        setShowAllItems(true);\n      }\n\n      menuOpenTrigger.current = trigger;\n      triggerState.open(focusStrategy);\n    }\n  };\n\n  let toggle = (focusStrategy?: FocusStrategy, trigger?: MenuTriggerAction) => {\n    let displayAllItems = (trigger === 'manual' || (trigger === 'focus' && menuTrigger === 'focus'));\n    // If the menu is closed and there is nothing to display, early return so toggle isn't called to prevent extraneous onOpenChange\n    if (!(allowsEmptyCollection || filteredCollection.size > 0 || (displayAllItems && originalCollection.size > 0) || props.items) && !triggerState.isOpen) {\n      return;\n    }\n\n    if (displayAllItems && !triggerState.isOpen && props.items === undefined) {\n      // Show all items if menu is toggled open. Only care about this if items are undefined\n      setShowAllItems(true);\n    }\n\n    // Only update the menuOpenTrigger if menu is currently closed\n    if (!triggerState.isOpen) {\n      menuOpenTrigger.current = trigger;\n    }\n\n    triggerState.toggle(focusStrategy);\n  };\n\n  let lastValue = useRef(inputValue);\n  let resetInputValue = () => {\n    let itemText = collection.getItem(selectedKey)?.textValue ?? '';\n    lastValue.current = itemText;\n    setInputValue(itemText);\n  };\n\n  let isInitialRender = useRef(true);\n  let lastSelectedKey = useRef(props.selectedKey ?? props.defaultSelectedKey ?? null);\n  let lastSelectedKeyText = useRef(collection.getItem(selectedKey)?.textValue ?? '');\n  // intentional omit dependency array, want this to happen on every render\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  useEffect(() => {\n    // If open state or inputValue is uncontrolled, open and close automatically when the input value changes,\n    // the input is if focused, and there are items in the collection or allowEmptyCollection is true.\n    if (\n      isFocused &&\n      (filteredCollection.size > 0 || allowsEmptyCollection) &&\n      !triggerState.isOpen &&\n      inputValue !== lastValue.current &&\n      menuTrigger !== 'manual' &&\n      (props.isOpen === undefined || props.inputValue === undefined)\n    ) {\n      open(null, 'input');\n    }\n\n    // Close the menu if the collection is empty and either open state or items are uncontrolled.\n    // Don't close menu if filtered collection size is 0 but we are currently showing all items via button press (only applies to uncontrolled items)\n    if (\n      !showAllItems &&\n      !allowsEmptyCollection &&\n      triggerState.isOpen &&\n      filteredCollection.size === 0 &&\n      (props.isOpen === undefined || props.items === undefined)\n    ) {\n      triggerState.close();\n    }\n\n    // Close when an item is selected, if open state or selectedKey is uncontrolled.\n    if (\n      selectedKey != null &&\n      selectedKey !== lastSelectedKey.current &&\n      (props.isOpen === undefined || props.selectedKey === undefined)\n    ) {\n      triggerState.close();\n    }\n\n    // Clear focused key when input value changes and display filtered collection again.\n    if (inputValue !== lastValue.current) {\n      selectionManager.setFocusedKey(null);\n      setShowAllItems(false);\n\n      // Set selectedKey to null when the user clears the input.\n      // If controlled, this is the application developer's responsibility.\n      if (inputValue === '' && (props.inputValue === undefined || props.selectedKey === undefined)) {\n        setSelectedKey(null);\n      }\n    }\n\n    // If it is the intial render and inputValue isn't controlled nor has an intial value, set input to match current selected key if any\n    if (isInitialRender.current && (props.inputValue === undefined && props.defaultInputValue === undefined)) {\n      resetInputValue();\n    }\n\n    // If the selectedKey changed, update the input value.\n    // Do nothing if both inputValue and selectedKey are controlled.\n    // In this case, it's the user's responsibility to update inputValue in onSelectionChange.\n    if (\n      selectedKey !== lastSelectedKey.current &&\n      (props.inputValue === undefined || props.selectedKey === undefined)\n    ) {\n      resetInputValue();\n    } else {\n      lastValue.current = inputValue;\n    }\n\n    // Update the inputValue if the selected item's text changes from its last tracked value.\n    // This is to handle cases where a selectedKey is specified but the items aren't available (async loading) or the selected item's text value updates.\n    // Only reset if the user isn't currently within the field so we don't erroneously modify user input.\n    // If inputValue is controlled, it is the user's responsibility to update the inputValue when items change.\n    let selectedItemText = collection.getItem(selectedKey)?.textValue ?? '';\n    if (!isFocused && selectedKey != null && props.inputValue === undefined && selectedKey === lastSelectedKey.current) {\n      if (lastSelectedKeyText.current !== selectedItemText) {\n        lastValue.current = selectedItemText;\n        setInputValue(selectedItemText);\n      }\n    }\n\n    isInitialRender.current = false;\n    lastSelectedKey.current = selectedKey;\n    lastSelectedKeyText.current = selectedItemText;\n  });\n\n  useEffect(() => {\n    // Reset focused key when the menu closes\n    if (!triggerState.isOpen) {\n      selectionManager.setFocusedKey(null);\n    }\n  }, [triggerState.isOpen, selectionManager]);\n\n  let commitCustomValue = () => {\n    let shouldClose = false;\n    lastSelectedKey.current = null;\n    setSelectedKey(null);\n\n    // If previous key was already null, need to manually call onSelectionChange since it won't be triggered by a setSelectedKey call\n    // This allows the application to control whether or not to close the menu on custom value commit\n    if (selectedKey === null && props.onSelectionChange) {\n      props.onSelectionChange(null);\n    }\n\n    // Should close menu ourselves if component open state or selected key is uncontrolled and therefore won't be closed by a user defined event handler\n    shouldClose = props.isOpen == null || props.selectedKey === undefined;\n\n    // Close if no other event will be fired. Otherwise, allow the\n    // application to control this based on that event.\n    if (shouldClose) {\n      triggerState.close();\n    }\n  };\n\n  let commitSelection = () => {\n    // If multiple things are controlled, call onSelectionChange\n    // Note that users who control open state and input value MUST also have a onSelectionChange handler to properly close the menu and reset input value\n    if (\n      (props.selectedKey !== undefined && props.inputValue !== undefined) ||\n      (props.inputValue !== undefined && props.isOpen !== undefined) ||\n      (props.selectedKey !== undefined && props.isOpen !== undefined)\n    ) {\n      props.onSelectionChange(selectedKey);\n\n      // If multiple things are controlled but inputValue isn't, reset the input value for the user\n      if (props.inputValue === undefined) {\n        resetInputValue();\n      }\n\n      // If multiple things are controlled but isOpen isn't, close the menu for the user\n      if (props.isOpen === undefined) {\n        // Stop menu from reopening from useEffect\n        let itemText = collection.getItem(selectedKey)?.textValue ?? '';\n        lastValue.current = itemText;\n        triggerState.close();\n      }\n    } else {\n      // If only a single aspect of combobox is controlled, reset input value and close menu for the user\n      resetInputValue();\n      triggerState.close();\n    }\n  };\n\n  let commit = () => {\n    if (triggerState.isOpen && selectionManager.focusedKey != null) {\n      // Reset inputValue and close menu here if the selected key is already the focused key. Otherwise\n      // fire onSelectionChange to allow the application to control the closing.\n      if (selectedKey === selectionManager.focusedKey) {\n        commitSelection();\n      } else {\n        setSelectedKey(selectionManager.focusedKey);\n      }\n    } else if (allowsCustomValue) {\n      commitCustomValue();\n    }\n  };\n\n  let setFocused = (isFocused: boolean) => {\n    if (isFocused) {\n      if (menuTrigger === 'focus') {\n        open(null, 'focus');\n      }\n    } else if (shouldCloseOnBlur) {\n      let itemText = collection.getItem(selectedKey)?.textValue ?? '';\n      if (allowsCustomValue && inputValue !== itemText) {\n        commitCustomValue();\n      } else {\n        commitSelection();\n      }\n    }\n\n    setFocusedState(isFocused);\n  };\n\n  return {\n    ...triggerState,\n    toggle,\n    open,\n    selectionManager,\n    selectedKey,\n    setSelectedKey,\n    disabledKeys,\n    isFocused,\n    setFocused,\n    selectedItem,\n    collection: showAllItems ? originalCollection : filteredCollection,\n    inputValue,\n    setInputValue,\n    commit\n  };\n}\n\nfunction filterCollection<T extends object>(collection: Collection<Node<T>>, inputValue: string, filter: FilterFn): Collection<Node<T>> {\n  return new ListCollection(filterNodes(collection, inputValue, filter));\n}\n\nfunction filterNodes<T>(nodes: Iterable<Node<T>>, inputValue: string, filter: FilterFn): Iterable<Node<T>> {\n  let filteredNode = [];\n  for (let node of nodes) {\n    if (node.type === 'section' && node.hasChildNodes) {\n      let filtered = filterNodes(node.childNodes, inputValue, filter);\n      if ([...filtered].length > 0) {\n        filteredNode.push({...node, childNodes: filtered});\n      }\n    } else if (node.type !== 'section' && filter(node.textValue, inputValue)) {\n      filteredNode.push({...node});\n    }\n  }\n  return filteredNode;\n}\n"],"names":["useComboBoxState","props","defaultFilter","menuTrigger","allowsEmptyCollection","allowsCustomValue","shouldCloseOnBlur","showAllItems","setShowAllItems","useState","isFocused","setFocusedState","inputValue","setInputValue","useControlledState","defaultInputValue","onInputChange","onSelectionChange","key","isOpen","undefined","selectedKey","resetInputValue","triggerState","close","collection","selectionManager","setSelectedKey","selectedItem","disabledKeys","useSingleSelectListState","items","defaultItems","originalCollection","filteredCollection","useMemo","filterCollection","menuOpenTrigger","useRef","onOpenChange","open","current","useMenuTriggerState","focusStrategy","trigger","displayAllItems","size","toggle","lastValue","itemText","getItem","textValue","isInitialRender","lastSelectedKey","defaultSelectedKey","lastSelectedKeyText","useEffect","setFocusedKey","selectedItemText","commitCustomValue","shouldClose","commitSelection","commit","focusedKey","setFocused","filter","ListCollection","filterNodes","nodes","filteredNode","node","type","hasChildNodes","filtered","childNodes","length","push"],"version":3,"file":"module.js.map"}