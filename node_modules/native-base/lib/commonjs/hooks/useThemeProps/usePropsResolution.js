var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.usePropsResolution=usePropsResolution;var _slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));var _extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends"));var _lodash=_interopRequireDefault(require("lodash.get"));var _lodash2=_interopRequireDefault(require("lodash.omit"));var _lodash3=_interopRequireDefault(require("lodash.isnil"));var _lodash4=_interopRequireDefault(require("lodash.merge"));var _reactNative=require("react-native");var _useNativeBase2=require("../useNativeBase");var _usePlatformProps=require("../usePlatformProps");var _colorMode=require("../../core/color-mode");var _utils=require("./utils");var _tools=require("./../../theme/tools");var _base=require("./../../theme/base");var _useContrastText=require("../useContrastText");var _react=_interopRequireDefault(require("react"));var simplifyComponentTheme=function simplifyComponentTheme(theme,componentTheme,incomingProps,colorModeProps,currentBreakpoint){var combinedProps=(0,_extends2.default)({},componentTheme.defaultProps,incomingProps);var componentBaseStyle={};if(componentTheme.baseStyle){componentBaseStyle=typeof componentTheme.baseStyle!=='function'?componentTheme.baseStyle:componentTheme.baseStyle((0,_extends2.default)({theme:theme},combinedProps,colorModeProps));}var variant=(0,_utils.resolveValueWithBreakpoint)(combinedProps.variant,currentBreakpoint,'variant');var componentVariantProps={};if(variant&&componentTheme.variants&&componentTheme.variants[variant]){componentVariantProps=typeof componentTheme.variants[variant]!=='function'?componentTheme.variants[variant]:componentTheme.variants[variant]((0,_extends2.default)({theme:theme},combinedProps,colorModeProps));incomingProps.variant=undefined;}var size=(0,_utils.resolveValueWithBreakpoint)(combinedProps.size,currentBreakpoint,'size');var componentSizeProps={};if(size&&componentTheme.sizes&&componentTheme.sizes[size]){if(typeof componentTheme.sizes[size]==='string'||typeof componentTheme.sizes[size]==='number'){componentSizeProps.size=componentTheme.sizes[size];}else if(typeof componentTheme.sizes[size]==='function'){componentSizeProps=componentTheme.sizes[size]((0,_extends2.default)({theme:theme},combinedProps,colorModeProps));}else{componentSizeProps=componentTheme.sizes[size];}incomingProps.size=undefined;}var componentMergedTheme=(0,_lodash4.default)({},componentTheme.defaultProps,componentBaseStyle,componentVariantProps,componentSizeProps);return componentMergedTheme;};var propTranslator=function propTranslator(_ref){var props=_ref.props,theme=_ref.theme,colorModeProps=_ref.colorModeProps,componentTheme=_ref.componentTheme,currentBreakpoint=_ref.currentBreakpoint;var translatedProps={};for(var property in props){if(property.startsWith('_')){var nestedTranslatedProps=propTranslator({props:props[property],theme:theme,colorModeProps:colorModeProps,componentTheme:componentTheme,currentBreakpoint:currentBreakpoint});translatedProps[property]=nestedTranslatedProps;}else if(_base.themePropertyMap[property]){var propValues=(0,_utils.extractPropertyFromFunction)(property,props,theme,componentTheme);if(typeof propValues==='string'||typeof propValues==='number'){translatedProps[property]=propValues;}else if(!(0,_lodash3.default)(propValues)){for(var nestedProp in propValues){translatedProps[nestedProp]=(0,_lodash.default)(theme,_base.themePropertyMap[nestedProp]+"."+propValues[nestedProp],propValues[nestedProp]);}delete translatedProps[property];}else if(property==='shadow'){var resolveValueWithBreakpointValue=(0,_utils.resolveValueWithBreakpoint)(props.shadow,currentBreakpoint,property);var shadowProps=theme[_base.themePropertyMap[property]](colorModeProps)[resolveValueWithBreakpointValue];translatedProps.style=(0,_lodash4.default)({},shadowProps,props.style);delete translatedProps[property];}else{translatedProps[property]=(0,_utils.resolveValueWithBreakpoint)(props[property],currentBreakpoint,property);}}else{translatedProps[property]=(0,_utils.resolveValueWithBreakpoint)(props[property],currentBreakpoint,property);}}return translatedProps;};var propsThatCannotHoldNegativityWithStrings=['m','margin','padding','p'];var matchRegex=new RegExp(/(\d*\.?\d+)\s?(px|em|ex|%|in|cn|mm|pt|pc+)/gim);var mutatePropToHandleNegativeVal=function mutatePropToHandleNegativeVal(theme,props,key){if(props[key]in theme.space){return;}if(typeof props[key]==='string'){var parsedNum=+props[key];if(!isNaN(parsedNum)){props[key]=parsedNum;}else if(!matchRegex.exec(props[key])){props[key]=undefined;}}};function usePropsResolution(component,incomingProps){var _useWindowDimensions,_platformSpecificProp,_platformSpecificProp2,_platformSpecificProp3,_platformSpecificProp4,_ref2,_translatedProps$bg,_translatedProps$_tex;var _extractInObject=(0,_tools.extractInObject)(incomingProps,['children','onPress','icon','onOpen','onClose']),_extractInObject2=(0,_slicedToArray2.default)(_extractInObject,2),ignoredProps=_extractInObject2[0],cleanIncomingProps=_extractInObject2[1];var _useNativeBase=(0,_useNativeBase2.useNativeBase)(),theme=_useNativeBase.theme;var colorModeProps=(0,_colorMode.useColorMode)();var componentTheme=(0,_lodash.default)(theme,"components."+component);var notComponentTheme=(0,_lodash2.default)(theme,['components']);var windowWidth=(_useWindowDimensions=(0,_reactNative.useWindowDimensions)())==null?void 0:_useWindowDimensions.width;var currentBreakpoint=_react.default.useMemo(function(){return(0,_tools.getClosestBreakpoint)(theme.breakpoints,windowWidth);},[windowWidth,theme.breakpoints]);var componentThemeObject=(0,_usePlatformProps.usePlatformProps)(simplifyComponentTheme(notComponentTheme,componentTheme,cleanIncomingProps,colorModeProps,currentBreakpoint));var componentThemeIntegratedProps=(0,_lodash4.default)({},componentThemeObject,cleanIncomingProps);var platformSpecificProps=(0,_usePlatformProps.usePlatformProps)(componentThemeIntegratedProps);var ignore=[];if((_platformSpecificProp=platformSpecificProps.bg)!=null&&_platformSpecificProp.linearGradient||(_platformSpecificProp2=platformSpecificProps.background)!=null&&_platformSpecificProp2.linearGradient||(_platformSpecificProp3=platformSpecificProps.bgColor)!=null&&_platformSpecificProp3.linearGradient||(_platformSpecificProp4=platformSpecificProps.backgroundColor)!=null&&_platformSpecificProp4.linearGradient){var _platformSpecificProp5,_platformSpecificProp6,_platformSpecificProp7;var bgProp='bg';if((_platformSpecificProp5=platformSpecificProps.background)!=null&&_platformSpecificProp5.linearGradient){bgProp='background';}else if((_platformSpecificProp6=platformSpecificProps.bgColor)!=null&&_platformSpecificProp6.linearGradient){bgProp='bgColor';}else if((_platformSpecificProp7=platformSpecificProps.backgroundColor)!=null&&_platformSpecificProp7.linearGradient){bgProp='backgroundColor';}platformSpecificProps[bgProp].linearGradient.colors=platformSpecificProps[bgProp].linearGradient.colors.map(function(color){return(0,_lodash.default)(theme.colors,color,color);});ignore=['bg','background','backgroundColor','bgColor'];}var _extractInObject3=(0,_tools.extractInObject)(platformSpecificProps,ignore),_extractInObject4=(0,_slicedToArray2.default)(_extractInObject3,2),gradientProps=_extractInObject4[0],nonGradientProps=_extractInObject4[1];var translatedProps=propTranslator({props:nonGradientProps,theme:notComponentTheme,colorModeProps:colorModeProps,componentTheme:componentTheme,currentBreakpoint:currentBreakpoint});var bgColor=(_ref2=(_translatedProps$bg=translatedProps.bg)!=null?_translatedProps$bg:translatedProps.backgroundColor)!=null?_ref2:translatedProps.bgColor;var contrastTextColor=(0,_useContrastText.useContrastText)(bgColor,translatedProps==null?void 0:(_translatedProps$_tex=translatedProps._text)==null?void 0:_translatedProps$_tex.color);translatedProps._text=contrastTextColor?(0,_extends2.default)({color:contrastTextColor},translatedProps._text):translatedProps._text;propsThatCannotHoldNegativityWithStrings.forEach(function(key){if(translatedProps&&key in translatedProps){mutatePropToHandleNegativeVal(theme,translatedProps,key);}});var resolvedProps=(0,_tools.omitUndefined)((0,_extends2.default)({},translatedProps,ignoredProps,gradientProps));return resolvedProps;}
//# sourceMappingURL=usePropsResolution.js.map